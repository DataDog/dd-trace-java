package com.datadog.iast.model

import datadog.trace.test.util.DDSpecification

import static com.datadog.iast.model.VulnerabilityType.WEAK_CIPHER

class VulnerabilityTypeTest extends DDSpecification {

  def 'test compute hash'(final VulnerabilityType type, final Location location, final Evidence evidence, final long expected) {
    when:
    final vulnerability = new Vulnerability(type, location, evidence)
    then:
    vulnerability.hash == expected

    where:
    type        | location                                                                     | evidence            | expected
    WEAK_CIPHER | Location.forSpanAndStack(123, new StackTraceElement("foo", "foo", "foo", 1)) | new Evidence("MD5") | 1045110372
    WEAK_CIPHER | Location.forSpanAndStack(456, new StackTraceElement("foo", "foo", "foo", 1)) | new Evidence("MD4") | 1045110372
    WEAK_CIPHER | Location.forSpanAndStack(789, new StackTraceElement("foo", "foo", "foo", 1)) | null                | 1045110372
    WEAK_CIPHER | Location.forSpanAndClassAndMethod(123, "foo", "foo")                         | new Evidence("MD5") | 3265519776
    WEAK_CIPHER | Location.forSpanAndClassAndMethod(456, "foo", "foo")                         | new Evidence("MD4") | 3265519776
    WEAK_CIPHER | Location.forSpanAndClassAndMethod(789, "foo", "foo")                         | null                | 3265519776
    WEAK_CIPHER | null                                                                         | new Evidence("MD5") | 1272119222
    WEAK_CIPHER | null                                                                         | new Evidence("MD4") | 1272119222
    WEAK_CIPHER | null                                                                         | null                | 1272119222
  }
}
