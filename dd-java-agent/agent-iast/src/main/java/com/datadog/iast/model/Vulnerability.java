package com.datadog.iast.model;

import javax.annotation.Nonnull;
import javax.annotation.Nullable;

public final class Vulnerability {

  private final @Nonnull VulnerabilityType type;

  private final @Nonnull Location location;

  private final @Nullable Evidence evidence;

  private final @Nullable String serviceName;

  private final long hash;

  public Vulnerability(
      final VulnerabilityType type, final Location location, final Evidence evidence) {
    this.type = type;
    this.location = location;
    this.evidence = evidence;
    this.serviceName = null;
    this.hash = type.calculateHash(this);
  }

  public Vulnerability(final VulnerabilityType type, final String serviceName) {
    this.type = type;
    this.location = null;
    this.evidence = null;
    this.serviceName = serviceName;
    this.hash = type.calculateHash(this);
  }

  public VulnerabilityType getType() {
    return type;
  }

  public Location getLocation() {
    return location;
  }

  public Evidence getEvidence() {
    return evidence;
  }

  @Nullable
  public String getServiceName() {
    return serviceName;
  }

  public long getHash() {
    return hash;
  }

  @Override
  public boolean equals(Object o) {
    if (this == o) {
      return true;
    }
    if (o == null || getClass() != o.getClass()) {
      return false;
    }
    Vulnerability that = (Vulnerability) o;
    return hash == that.hash;
  }

  @Override
  public int hashCode() {
    return ((Long) hash).hashCode();
  }
}
