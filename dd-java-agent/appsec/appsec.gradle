plugins {
  id "com.github.johnrengelman.shadow"
}

apply from: "$rootDir/gradle/java.gradle"

repositories {
  ivy {
    artifactPattern 'http://sqreen-ci-java.s3-website-us-east-1.amazonaws.com/jars/[organisation]/[artifact]-[revision](-[classifier]).[ext]'
    ivyPattern 'http://sqreen-ci-java.s3-website-us-east-1.amazonaws.com/jars/[organisation]/[module]-[revision].xml'
  }
}

dependencies {
  compile deps.slf4j
  compile project(':internal-api')
  compile group: 'io.sqreen', name: 'libsqreen', version: '1.1.2.2'
  compileOnly group: 'org.yaml', name: 'snakeyaml', version: '1.28'
  compileOnly group: 'com.squareup.moshi', name: 'moshi', version: '1.9.2'
}

sourceCompatibility = JavaVersion.VERSION_1_8
targetCompatibility = JavaVersion.VERSION_1_8

configurations {
  // exclude bootstrap dependencies from shadowJar
  runtime.exclude module: deps.slf4j
  runtime.exclude group: 'org.slf4j'
}

shadowJar {
  exclude '**/*-dbgsym.zip'
  dependencies deps.sharedInverse
  dependencies {
    exclude(project(':dd-java-agent:agent-bootstrap'))
    exclude(project(':dd-java-agent:agent-logging'))
    exclude(project(':dd-trace-api'))
    exclude(project(':internal-api'))
    exclude(dependency('org.slf4j::'))
  }
}

jar {
  classifier = 'unbundled'
}
