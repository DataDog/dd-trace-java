plugins {
  id 'java-test-fixtures'
}

muzzle {
  fail {
    group = 'io.servicetalk'
    module = 'servicetalk-concurrent-api'
    versions = '[,0.42.56)'
  }
  pass {
    group = 'io.servicetalk'
    module = 'servicetalk-concurrent-api'
    // 0.42.56 is the earliest version where CapturedContext is public
    versions = '[0.42.56,]'
  }
}

apply from: "$rootDir/gradle/java.gradle"

testJvmConstraints {
  minJavaVersion = JavaVersion.VERSION_11
}

//addTestSuiteForDir('latestDepTest', 'test')
// TODO currently 0.42.56 is the latest version. Enable this once the next (0.42.57) is out, add 'latestDepTest'

dependencies {
  compileOnly group: 'io.servicetalk', name: 'servicetalk-concurrent-api', version: '0.42.56'
  compileOnly group: 'io.servicetalk', name: 'servicetalk-context-api', version: '0.42.56'

  testImplementation group: 'io.servicetalk', name: 'servicetalk-concurrent-api', version: '0.42.56'
  testImplementation group: 'io.servicetalk', name: 'servicetalk-context-api', version: '0.42.56'

  // import the previous instrumentation into the test to ensure that it does not interfere with it
  testRuntimeOnly project(":dd-java-agent:instrumentation:servicetalk:servicetalk-0.42.0")

  // TODO currently 0.42.56 is the latest version. Enable this once the next (0.42.57) is out, add 'latestDepTest'
  //  latestDepTestImplementation group: 'io.servicetalk', name: 'servicetalk-concurrent-api', version: '+'
  //  latestDepTestImplementation group: 'io.servicetalk', name: 'servicetalk-context-api', version: '+'
}

