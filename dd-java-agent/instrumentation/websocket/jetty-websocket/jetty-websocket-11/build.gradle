ext {
  minJavaVersionForTests = JavaVersion.VERSION_11
}

muzzle {
  pass {
    name = 'jetty-websocket-11'
    group = 'org.eclipse.jetty.websocket'
    module = 'websocket-jakarta-server'
    versions = "[11,12)"
    javaVersion = "11"
    assertInverse = true
  }
}

apply from: "$rootDir/gradle/java.gradle"

addTestSuite("latestDepTest")

[compileTestGroovy, compileLatestDepTestGroovy].each {
  it.javaLauncher = getJavaLauncherFor(11)
}

dependencies {
  implementation project(":dd-java-agent:instrumentation:websocket:jetty-websocket:jetty-websocket-10")
  testImplementation group: 'org.eclipse.jetty.websocket', name: 'websocket-jakarta-server', version: '11.0.0'
  latestDepTestImplementation group: 'org.eclipse.jetty.websocket', name: 'websocket-jakarta-server', version: '11.+'

  testRuntimeOnly project(":dd-java-agent:instrumentation:websocket:jetty-websocket:jetty-websocket-10")
  testRuntimeOnly project(":dd-java-agent:instrumentation:websocket:jakarta-websocket-2.0")

  configurations.all {
    it.resolutionStrategy {
      force libs.slf4j
    }
  }
}
