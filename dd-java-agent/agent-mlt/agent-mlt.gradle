plugins {
  id "com.github.johnrengelman.shadow"
}

ext {
  enableJunitPlatform = true
  minJavaVersionForTests = JavaVersion.VERSION_1_8
}

apply from: "$rootDir/gradle/java.gradle"

excludedClassesCoverage += [
  // need to exclude - the branch coverage settings don't seem to work :/
  'com.datadog.mlt.sampler.JMXSampler'
]

dependencies {
  compile deps.slf4j
  compile project(':internal-api')
  compile project(':utils:mlt-support')

  testCompile project(":dd-java-agent:testing")
  testCompile deps.junit5
  testCompile deps.guava
  testCompile deps.mockito
}

minimumInstructionCoverage = 0.5
minimumBranchCoverage = 0.5

excludedClassesCoverage += [
  // MLT trace installer is a simple forwarding shell for MethodLevelTracer.initialize()
  'datadog.trace.agent.mlt.MethodLevelTracerInstaller',
  'com.datadog.mlt.sampler.JmxThreadStackProvider',
  'com.datadog.mlt.sampler.NoneThreadStackProvider',
  'com.datadog.mlt.sampler.ThreadStackProvider'
]
excludedClassesBranchCoverage += [
  'com.datadog.mlt.sampler.ScopeStackCollector',
]

sourceCompatibility = JavaVersion.VERSION_1_8
targetCompatibility = JavaVersion.VERSION_1_8

shadowJar {
  configurations = [project.configurations.compile]
  archiveClassifier.set('')

  dependencies deps.sharedInverse
  dependencies {
    include(project(':utils:mlt-support'))
    include(dependency('it.unimi.dsi:fastutil:8.2.1'))
  }
  minimize()
}
