apply from: "$rootDir/gradle/java.gradle"
description = 'Tracer Flare Smoke Tests.'

tasks.named("jar", Jar) {
  manifest {
    attributes('Main-Class': 'datadog.smoketest.flare.SimpleApp')
  }
}

dependencies {
  testImplementation project(':dd-smoke-tests')
}

tasks.withType(Test).configureEach {
  dependsOn "jar"

  jvmArgumentProviders.add(new CommandLineArgumentProvider() {
      @Override
      Iterable<String> asArguments() {
        def jarTask = tasks.named('jar', Jar).get()
        return ["-Ddatadog.smoketest.tracer-flare.jar.path=${jarTask.archiveFile.get()}"]
      }
    })
}
