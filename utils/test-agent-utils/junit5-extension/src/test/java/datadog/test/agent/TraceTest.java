package datadog.test.agent;

import static org.junit.jupiter.api.Assertions.*;

import org.junit.jupiter.api.Test;
import java.io.IOException;
import java.util.List;

class TraceTest {

  @Test
  void testJson() throws IOException {
//    String payload = "[{\"service\": \"root-servlet\", \"name\": \"servlet.request\", \"resource\": \"GET /error\", \"trace_id\": 3405416295629855573, \"span_id\": 4828086958362054321, \"parent_id\": 0, \"start\": 1733850755343245042, \"duration\": 82339541, \"type\": \"web\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 37, \"process_id\": 94118, \"_dd.profiling.enabled\": 0, \"_dd.agent_psr\": 1.0, \"peer.port\": 51627, \"_dd.trace_span_attribute_schema\": 0}, \"meta\": {\"_dd.p.dm\": \"-1\", \"_dd.p.tid\": \"6758768300000000\", \"thread.name\": \"http-nio-8080-exec-1\", \"http.status_code\": \"404\", \"_dd.tracer_host\": \"COMP-HXCY7WX25L\", \"servlet.path\": \"/\", \"_dd.base_service\": \"smoke-tests-template\", \"http.url\": \"http://localhost:8080/\", \"language\": \"jvm\", \"env\": \"smoketest\", \"peer.ipv4\": \"127.0.0.1\", \"http.hostname\": \"localhost\", \"component\": \"tomcat-server\", \"span.kind\": \"server\", \"servlet.context\": \"/\", \"http.route\": \"/error\", \"runtime-id\": \"cf1ea7cb-cfe0-49ae-a5b6-a6ce72ef5bb1\", \"http.method\": \"GET\", \"http.useragent\": \"okhttp/3.12.15\"}}]";
    String payload = "[[{\"service\": \"root-servlet\", \"name\": \"servlet.request\", \"resource\": \"GET /error\", \"trace_id\": 3405416295629855573, \"span_id\": 4828086958362054321, \"parent_id\": 0, \"start\": 1733850755343245042, \"duration\": 82339541, \"type\": \"web\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 37, \"process_id\": 94118, \"_dd.profiling.enabled\": 0, \"_dd.agent_psr\": 1.0, \"peer.port\": 51627, \"_dd.trace_span_attribute_schema\": 0}, \"meta\": {\"_dd.p.dm\": \"-1\", \"_dd.p.tid\": \"6758768300000000\", \"thread.name\": \"http-nio-8080-exec-1\", \"http.status_code\": \"404\", \"_dd.tracer_host\": \"COMP-HXCY7WX25L\", \"servlet.path\": \"/\", \"_dd.base_service\": \"smoke-tests-template\", \"http.url\": \"http://localhost:8080/\", \"language\": \"jvm\", \"env\": \"smoketest\", \"peer.ipv4\": \"127.0.0.1\", \"http.hostname\": \"localhost\", \"component\": \"tomcat-server\", \"span.kind\": \"server\", \"servlet.context\": \"/\", \"http.route\": \"/error\", \"runtime-id\": \"cf1ea7cb-cfe0-49ae-a5b6-a6ce72ef5bb1\", \"http.method\": \"GET\", \"http.useragent\": \"okhttp/3.12.15\"}}, {\"service\": \"root-servlet\", \"name\": \"spring.handler\", \"resource\": \"BasicErrorController.error\", \"trace_id\": 3405416295629855573, \"span_id\": 6641388385657200736, \"parent_id\": 4828086958362054321, \"start\": 1733850755388544000, \"duration\": 36611750, \"type\": \"web\", \"error\": 0, \"metrics\": {\"_dd.measured\": 1, \"thread.id\": 37}, \"meta\": {\"_dd.p.tid\": \"6758768300000000\", \"thread.name\": \"http-nio-8080-exec-1\", \"_dd.base_service\": \"smoke-tests-template\", \"language\": \"jvm\", \"component\": \"spring-web-controller\", \"env\": \"smoketest\", \"span.kind\": \"server\"}}, {\"service\": \"root-servlet\", \"name\": \"spring.handler\", \"resource\": \"ResourceHttpRequestHandler.handleRequest\", \"trace_id\": 3405416295629855573, \"span_id\": 7235937508788162189, \"parent_id\": 4828086958362054321, \"start\": 1733850755385197708, \"duration\": 98917, \"type\": \"web\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"thread.id\": 37}, \"meta\": {\"_dd.p.tid\": \"6758768300000000\", \"thread.name\": \"http-nio-8080-exec-1\", \"_dd.base_service\": \"smoke-tests-template\", \"language\": \"jvm\", \"component\": \"spring-web-controller\", \"env\": \"smoketest\", \"span.kind\": \"server\"}}], [{\"service\": \"root-servlet\", \"name\": \"servlet.request\", \"resource\": \"GET /fruits\", \"trace_id\": 3039873998845404183, \"span_id\": 1240558624704317785, \"parent_id\": 0, \"start\": 1733850755427596875, \"duration\": 51084333, \"type\": \"web\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 38, \"process_id\": 94118, \"_dd.profiling.enabled\": 0, \"_dd.agent_psr\": 1.0, \"peer.port\": 51627, \"_dd.trace_span_attribute_schema\": 0}, \"meta\": {\"_dd.p.dm\": \"-1\", \"_dd.p.tid\": \"6758768300000000\", \"thread.name\": \"http-nio-8080-exec-2\", \"http.status_code\": \"200\", \"_dd.tracer_host\": \"COMP-HXCY7WX25L\", \"servlet.path\": \"/fruits\", \"_dd.base_service\": \"smoke-tests-template\", \"http.url\": \"http://localhost:8080/fruits\", \"language\": \"jvm\", \"env\": \"smoketest\", \"peer.ipv4\": \"127.0.0.1\", \"http.hostname\": \"localhost\", \"component\": \"tomcat-server\", \"span.kind\": \"server\", \"servlet.context\": \"/\", \"http.route\": \"/fruits\", \"runtime-id\": \"cf1ea7cb-cfe0-49ae-a5b6-a6ce72ef5bb1\", \"http.method\": \"GET\", \"http.useragent\": \"okhttp/3.12.15\"}}, {\"service\": \"root-servlet\", \"name\": \"spring.handler\", \"resource\": \"FruitController.listFruits\", \"trace_id\": 3039873998845404183, \"span_id\": 2210482653780015799, \"parent_id\": 1240558624704317785, \"start\": 1733850755428527458, \"duration\": 49943292, \"type\": \"web\", \"error\": 0, \"metrics\": {\"_dd.measured\": 1, \"thread.id\": 38}, \"meta\": {\"_dd.p.tid\": \"6758768300000000\", \"thread.name\": \"http-nio-8080-exec-2\", \"_dd.base_service\": \"smoke-tests-template\", \"language\": \"jvm\", \"component\": \"spring-web-controller\", \"env\": \"smoketest\", \"span.kind\": \"server\"}}, {\"service\": \"root-servlet\", \"name\": \"repository.operation\", \"resource\": \"FruitRepository.findAll\", \"trace_id\": 3039873998845404183, \"span_id\": 5978068300206110043, \"parent_id\": 2210482653780015799, \"start\": 1733850755428995042, \"duration\": 42321291, \"type\": null, \"error\": 0, \"metrics\": {\"_dd.measured\": 1, \"thread.id\": 38}, \"meta\": {\"_dd.p.tid\": \"6758768300000000\", \"thread.name\": \"http-nio-8080-exec-2\", \"_dd.base_service\": \"smoke-tests-template\", \"component\": \"spring-data\", \"env\": \"smoketest\", \"span.kind\": \"client\"}}, {\"service\": \"h2\", \"name\": \"h2.query\", \"resource\": \"select f1_0.id,f1_0.name from fruit f1_0\", \"trace_id\": 3039873998845404183, \"span_id\": 5799598613710104604, \"parent_id\": 5978068300206110043, \"start\": 1733850755468024500, \"duration\": 233708, \"type\": \"sql\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 38}, \"meta\": {\"_dd.p.tid\": \"6758768300000000\", \"thread.name\": \"http-nio-8080-exec-2\", \"db.instance\": \"fruitdb\", \"component\": \"java-jdbc-prepared_statement\", \"db.type\": \"h2\", \"db.user\": \"sa\", \"span.kind\": \"client\", \"_dd.base_service\": \"smoke-tests-template\", \"db.operation\": \"select\", \"env\": \"smoketest\", \"db.pool.name\": \"HikariPool-1\"}}], [{\"service\": \"h2\", \"name\": \"h2.query\", \"resource\": \"drop table if exists fruit cascade \", \"trace_id\": 1275027498898344711, \"span_id\": 6079672473321702846, \"parent_id\": 0, \"start\": 1733850754467438083, \"duration\": 697375, \"type\": \"sql\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1, \"process_id\": 94118, \"_dd.profiling.enabled\": 0, \"_dd.agent_psr\": 1.0, \"_dd.trace_span_attribute_schema\": 0}, \"meta\": {\"_dd.p.dm\": \"-1\", \"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"_dd.tracer_host\": \"COMP-HXCY7WX25L\", \"db.type\": \"h2\", \"_dd.base_service\": \"smoke-tests-template\", \"db.operation\": \"drop\", \"language\": \"jvm\", \"env\": \"smoketest\", \"db.instance\": \"fruitdb\", \"component\": \"java-jdbc-statement\", \"db.user\": \"sa\", \"span.kind\": \"client\", \"runtime-id\": \"cf1ea7cb-cfe0-49ae-a5b6-a6ce72ef5bb1\", \"db.pool.name\": \"HikariPool-1\"}}], [{\"service\": \"h2\", \"name\": \"h2.query\", \"resource\": \"drop sequence if exists fruit_seq\", \"trace_id\": 646421320403115442, \"span_id\": 3974487824519136239, \"parent_id\": 0, \"start\": 1733850754468337083, \"duration\": 132834, \"type\": \"sql\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1, \"process_id\": 94118, \"_dd.profiling.enabled\": 0, \"_dd.agent_psr\": 1.0, \"_dd.trace_span_attribute_schema\": 0}, \"meta\": {\"_dd.p.dm\": \"-1\", \"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"_dd.tracer_host\": \"COMP-HXCY7WX25L\", \"db.type\": \"h2\", \"_dd.base_service\": \"smoke-tests-template\", \"db.operation\": \"drop\", \"language\": \"jvm\", \"env\": \"smoketest\", \"db.instance\": \"fruitdb\", \"component\": \"java-jdbc-statement\", \"db.user\": \"sa\", \"span.kind\": \"client\", \"runtime-id\": \"cf1ea7cb-cfe0-49ae-a5b6-a6ce72ef5bb1\", \"db.pool.name\": \"HikariPool-1\"}}], [{\"service\": \"h2\", \"name\": \"h2.query\", \"resource\": \"create sequence fruit_seq start with ? increment by ?\", \"trace_id\": 4778179668691348560, \"span_id\": 8620487103059137459, \"parent_id\": 0, \"start\": 1733850754470960792, \"duration\": 966208, \"type\": \"sql\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1, \"process_id\": 94118, \"_dd.profiling.enabled\": 0, \"_dd.agent_psr\": 1.0, \"_dd.trace_span_attribute_schema\": 0}, \"meta\": {\"_dd.p.dm\": \"-1\", \"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"_dd.tracer_host\": \"COMP-HXCY7WX25L\", \"db.type\": \"h2\", \"_dd.base_service\": \"smoke-tests-template\", \"db.operation\": \"create\", \"language\": \"jvm\", \"env\": \"smoketest\", \"db.instance\": \"fruitdb\", \"component\": \"java-jdbc-statement\", \"db.user\": \"sa\", \"span.kind\": \"client\", \"runtime-id\": \"cf1ea7cb-cfe0-49ae-a5b6-a6ce72ef5bb1\", \"db.pool.name\": \"HikariPool-1\"}}], [{\"service\": \"h2\", \"name\": \"h2.query\", \"resource\": \"create table fruit (id bigint not null, name varchar(?) not null, primary key (id))\", \"trace_id\": 5555106177684576827, \"span_id\": 8931996393299697363, \"parent_id\": 0, \"start\": 1733850754472233292, \"duration\": 1850500, \"type\": \"sql\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1, \"process_id\": 94118, \"_dd.profiling.enabled\": 0, \"_dd.agent_psr\": 1.0, \"_dd.trace_span_attribute_schema\": 0}, \"meta\": {\"_dd.p.dm\": \"-1\", \"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"_dd.tracer_host\": \"COMP-HXCY7WX25L\", \"db.type\": \"h2\", \"_dd.base_service\": \"smoke-tests-template\", \"db.operation\": \"create\", \"language\": \"jvm\", \"env\": \"smoketest\", \"db.instance\": \"fruitdb\", \"component\": \"java-jdbc-statement\", \"db.user\": \"sa\", \"span.kind\": \"client\", \"runtime-id\": \"cf1ea7cb-cfe0-49ae-a5b6-a6ce72ef5bb1\", \"db.pool.name\": \"HikariPool-1\"}}], [{\"service\": \"smoke-tests-template\", \"name\": \"repository.operation\", \"resource\": \"FruitRepository.save\", \"trace_id\": 4130291224090540855, \"span_id\": 2566327618612157503, \"parent_id\": 0, \"start\": 1733850754645395542, \"duration\": 34104083, \"type\": null, \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1, \"process_id\": 94118, \"_dd.profiling.enabled\": 0, \"_dd.agent_psr\": 1.0, \"_dd.trace_span_attribute_schema\": 0}, \"meta\": {\"_dd.p.dm\": \"-1\", \"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"_dd.tracer_host\": \"COMP-HXCY7WX25L\", \"component\": \"spring-data\", \"span.kind\": \"client\", \"runtime-id\": \"cf1ea7cb-cfe0-49ae-a5b6-a6ce72ef5bb1\", \"language\": \"jvm\", \"env\": \"smoketest\", \"version\": \"99\"}}, {\"service\": \"h2\", \"name\": \"h2.query\", \"resource\": \"insert into fruit (name, id) values (?, ?)\", \"trace_id\": 4130291224090540855, \"span_id\": 1833822828691182330, \"parent_id\": 2566327618612157503, \"start\": 1733850754677870625, \"duration\": 392250, \"type\": \"sql\", \"error\": 0, \"metrics\": {\"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1}, \"meta\": {\"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"db.instance\": \"fruitdb\", \"component\": \"java-jdbc-prepared_statement\", \"db.type\": \"h2\", \"db.user\": \"sa\", \"span.kind\": \"client\", \"_dd.base_service\": \"smoke-tests-template\", \"db.operation\": \"insert\", \"env\": \"smoketest\", \"db.pool.name\": \"HikariPool-1\"}}, {\"service\": \"h2\", \"name\": \"h2.query\", \"resource\": \"select next value for fruit_seq\", \"trace_id\": 4130291224090540855, \"span_id\": 3031403460078409243, \"parent_id\": 2566327618612157503, \"start\": 1733850754662096958, \"duration\": 715792, \"type\": \"sql\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1}, \"meta\": {\"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"db.instance\": \"fruitdb\", \"component\": \"java-jdbc-prepared_statement\", \"db.type\": \"h2\", \"db.user\": \"sa\", \"span.kind\": \"client\", \"_dd.base_service\": \"smoke-tests-template\", \"db.operation\": \"select\", \"env\": \"smoketest\", \"db.pool.name\": \"HikariPool-1\"}}], [{\"service\": \"smoke-tests-template\", \"name\": \"repository.operation\", \"resource\": \"FruitRepository.save\", \"trace_id\": 958824731038336609, \"span_id\": 6861307414939848484, \"parent_id\": 0, \"start\": 1733850754679709208, \"duration\": 786292, \"type\": null, \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1, \"process_id\": 94118, \"_dd.profiling.enabled\": 0, \"_dd.agent_psr\": 1.0, \"_dd.trace_span_attribute_schema\": 0}, \"meta\": {\"_dd.p.dm\": \"-1\", \"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"_dd.tracer_host\": \"COMP-HXCY7WX25L\", \"component\": \"spring-data\", \"span.kind\": \"client\", \"runtime-id\": \"cf1ea7cb-cfe0-49ae-a5b6-a6ce72ef5bb1\", \"language\": \"jvm\", \"env\": \"smoketest\", \"version\": \"99\"}}, {\"service\": \"h2\", \"name\": \"h2.query\", \"resource\": \"insert into fruit (name, id) values (?, ?)\", \"trace_id\": 958824731038336609, \"span_id\": 1368906671287965470, \"parent_id\": 6861307414939848484, \"start\": 1733850754680253000, \"duration\": 83375, \"type\": \"sql\", \"error\": 0, \"metrics\": {\"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1}, \"meta\": {\"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"db.instance\": \"fruitdb\", \"component\": \"java-jdbc-prepared_statement\", \"db.type\": \"h2\", \"db.user\": \"sa\", \"span.kind\": \"client\", \"_dd.base_service\": \"smoke-tests-template\", \"db.operation\": \"insert\", \"env\": \"smoketest\", \"db.pool.name\": \"HikariPool-1\"}}, {\"service\": \"h2\", \"name\": \"h2.query\", \"resource\": \"select next value for fruit_seq\", \"trace_id\": 958824731038336609, \"span_id\": 1483138575224530853, \"parent_id\": 6861307414939848484, \"start\": 1733850754679961083, \"duration\": 82750, \"type\": \"sql\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1}, \"meta\": {\"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"db.instance\": \"fruitdb\", \"component\": \"java-jdbc-prepared_statement\", \"db.type\": \"h2\", \"db.user\": \"sa\", \"span.kind\": \"client\", \"_dd.base_service\": \"smoke-tests-template\", \"db.operation\": \"select\", \"env\": \"smoketest\", \"db.pool.name\": \"HikariPool-1\"}}], [{\"service\": \"smoke-tests-template\", \"name\": \"repository.operation\", \"resource\": \"FruitRepository.save\", \"trace_id\": 4369599573668124799, \"span_id\": 9105364126036635200, \"parent_id\": 0, \"start\": 1733850754680603625, \"duration\": 523917, \"type\": null, \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1, \"process_id\": 94118, \"_dd.profiling.enabled\": 0, \"_dd.agent_psr\": 1.0, \"_dd.trace_span_attribute_schema\": 0}, \"meta\": {\"_dd.p.dm\": \"-1\", \"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"_dd.tracer_host\": \"COMP-HXCY7WX25L\", \"component\": \"spring-data\", \"span.kind\": \"client\", \"runtime-id\": \"cf1ea7cb-cfe0-49ae-a5b6-a6ce72ef5bb1\", \"language\": \"jvm\", \"env\": \"smoketest\", \"version\": \"99\"}}, {\"service\": \"h2\", \"name\": \"h2.query\", \"resource\": \"insert into fruit (name, id) values (?, ?)\", \"trace_id\": 4369599573668124799, \"span_id\": 71787552815533555, \"parent_id\": 9105364126036635200, \"start\": 1733850754680904500, \"duration\": 87292, \"type\": \"sql\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1}, \"meta\": {\"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"db.instance\": \"fruitdb\", \"component\": \"java-jdbc-prepared_statement\", \"db.type\": \"h2\", \"db.user\": \"sa\", \"span.kind\": \"client\", \"_dd.base_service\": \"smoke-tests-template\", \"db.operation\": \"insert\", \"env\": \"smoketest\", \"db.pool.name\": \"HikariPool-1\"}}], [{\"service\": \"h2\", \"name\": \"h2.query\", \"resource\": \"select * from INFORMATION_SCHEMA.SEQUENCES\", \"trace_id\": 5751494186948650058, \"span_id\": 9185267948987698934, \"parent_id\": 0, \"start\": 1733850754127471750, \"duration\": 2793958, \"type\": \"sql\", \"error\": 0, \"metrics\": {\"_sampling_priority_v1\": 1, \"_dd.measured\": 1, \"_dd.top_level\": 1, \"thread.id\": 1, \"process_id\": 94118, \"_dd.profiling.enabled\": 0, \"_dd.agent_psr\": 1.0, \"_dd.trace_span_attribute_schema\": 0}, \"meta\": {\"_dd.p.dm\": \"-1\", \"_dd.p.tid\": \"6758768200000000\", \"thread.name\": \"main\", \"_dd.tracer_host\": \"COMP-HXCY7WX25L\", \"db.type\": \"h2\", \"_dd.base_service\": \"smoke-tests-template\", \"db.operation\": \"select\", \"language\": \"jvm\", \"env\": \"smoketest\", \"db.instance\": \"fruitdb\", \"component\": \"java-jdbc-prepared_statement\", \"db.user\": \"sa\", \"span.kind\": \"client\", \"runtime-id\": \"cf1ea7cb-cfe0-49ae-a5b6-a6ce72ef5bb1\", \"db.pool.name\": \"HikariPool-1\"}}]]";
    List<Trace> traces = Trace.fromJsonArray(payload);
    assertEquals(1, traces.size());
  }


}
