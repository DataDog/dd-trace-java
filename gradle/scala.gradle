apply plugin: 'scala'

def forkedScalaCompileLimit = gradle.sharedServices.registerIfAbsent("forkedScalaCompileLimit", BuildService) {
  maxParallelUsages = 1
}

tasks.withType(ScalaCompile).configureEach {
  // don't use the incremental compiler
  scalaCompileOptions.with {
    force = true
  }
  // use 1G of memory
  scalaCompileOptions.forkOptions.with {
    memoryMaximumSize = '1G'
  }
  // limit concurrent compiles
  usesService(forkedScalaCompileLimit)
}

dependencies {
  // use latest version of zinc 1.3.x
  zinc 'org.scala-sbt:zinc_2.12:1.3.5'
  // use the same scala 2.12 version as the rest of the build
  zinc deps.scala212
}
