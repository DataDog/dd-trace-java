stages:
  - build
  - test
  - benchmark
  - deploy

default:
  tags:
    - arch:amd64


build_a:
  stage: build
  script:
    - echo "This job builds something quickly."

build_b:
  stage: build
  script:
    - echo "This job builds something else slowly."

test_a:
  stage: test
  needs: [build_a]
  script:
    - echo "This test job will start as soon as build_a finishes."
    - echo "It will not wait for build_b, or other jobs in the build stage, to finish."

test_b:
  stage: test
  needs: [build_b]
  script:
    - echo "This test job will start as soon as build_b finishes."
    - echo "It will not wait for other jobs in the build stage to finish."

test_c:
  stage: test
  needs: [build_b]
  when: manual
  script:
    - echo "block benchmarks?"

benchmark_1:
  stage: benchmark
  script:
    - echo "benchmark job"

benchmark_2:
  stage: benchmark
  script:
    - echo "benchmark job"

benchmark_3:
  stage: benchmark
  needs: [benchmark_1, benchmark_2]
  script:
    - echo "benchmark job"

deploy_a:
  stage: deploy
  needs: [test_a]
  script:
    - echo "Since build_a and test_a run quickly, this deploy job can run much earlier."
    - echo "It does not need to wait for build_b or test_b."
  environment: production

deploy_b:
  stage: deploy
  needs: [test_b]
  script:
    - echo "Since build_b and test_b run slowly, this deploy job will run much later."
  environment: production

